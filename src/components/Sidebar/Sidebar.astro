---
import Navigation from '@/components/Sidebar/Navigation.astro';
import Social from '@/components/Sidebar/Social.astro';
import { Icon } from 'astro-icon/components';
import { getLangFromUrl, useTranslations } from '../../i18n/utils';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<header
  class="fixed flex inset-[25px] md:inset-[33px] lg:inset-[41px] xl:inset-[49px] 2xl:inset-[57px] max-md:w-0 md:w-1/3 max-w-80 group-[.sidebar--toggle]/frame-content:max-md:w-[max(33.333%,_15rem)] items-center z-50 [transition:width_300ms_ease-in-out]"
>
  <div
    id="sidebar"
    class="relative h-full w-full group-[.sidebar--toggle]/frame-content:max-md:shadow-sidebar max-md:bg-frame/90 max-md:backdrop-blur-[8px] max-md:[transition:box-shadow_100ms_ease-in-out,background-color_100ms_ease-in-out_300ms,backdrop-filter_100ms_ease-in-out_300ms] group-[.sidebar--toggle]/frame-content:max-md:[transition:background-color_100ms_ease-in-out_300ms]"
  >
    <div
      class="absolute h-full w-full transition-opacity duration-100 delay-300 md:opacity-0 max-md:opacity-100 max-md:bg-overlay"
    >
    </div>
    <div
      class="h-full w-full flex flex-col items-left justify-between self-stretch grow overflow-hidden"
    >
      <div
        id="info"
        class="flex flex-col self-stretch p-4 gap-1 sm:p-6 md:p-8 lg:p-10 xl:p-12 2xl:p-14 [transition:transform_400ms_ease-in-out] max-md:-translate-x-40 group-[.sidebar--toggle]/frame-content:max-md:translate-x-0"
      >
        <div
          class="font-sans font-semibold text-xl md:text-2xl xl:text-3xl leading-5 whitespace-nowrap"
        >
          Florian Ohrel
        </div>
        <div
          class="font-slab font-normal text-base md:text-lg xl:text-xl leading-5 whitespace-nowrap"
        >
          {t('jobTitle')}
        </div>
      </div>
      <Navigation />
      <Social />
    </div>
  </div>
  <button
    id="sidebar-toggle-btn"
    aria-label="Toggle sidebar menu"
    class="w-6 h-6 -translate-x-3 inset-[inherit] text-mint hover:text-mintHover z-50 md:x-collapse md:[transition:width_300ms_ease-in-out] max-md:[transition:width_300ms_ease-in-out_300ms,color_100ms_ease-in-out,background-color_300ms,backdrop-filter_300ms,box-shadow_100ms_ease-in-out] bg-frame/30 backdrop-blur-[4px] group-[.sidebar--toggle]/frame-content:max-md:shadow-sidebar"
  >
    <div
      class="w-6 h-6 md:x-collapse md:[transition:width_300ms_ease-in-out] max-md:[transition:width_300ms_ease-in-out_300ms]"
    >
      <Icon
        name="material-symbols:left-panel-open-sharp"
        title="Open sidebar menu"
        class="group-[.sidebar--toggle]/frame-content:max-md:hidden max-md:block md:hidden w-full h-full"
      />
      <Icon
        name="material-symbols:left-panel-close-sharp"
        title="Close sidebar menu"
        class="group-[.sidebar--toggle]/frame-content:max-md:block hidden w-full h-full"
      />
    </div>
  </button>
</header>

<script>
  document.addEventListener('astro:page-load', () => {
    const contentFrame = document.getElementById('frame-content');
    const navSelected = document.querySelector('li.selected .nav__selector');

    document
      .getElementById('sidebar-toggle-btn')
      ?.addEventListener('click', () => {
        if (contentFrame?.classList.toggle('sidebar--toggle')) {
          navSelected?.classList.add('nav__selector--toggle');
        } else {
          navSelected?.classList.remove('nav__selector--toggle');
        }
      });

    window.addEventListener('resize', () => {
      if (window.matchMedia('(min-width: 768px)').matches) {
        navSelected?.classList.add('nav__selector--toggle');
      } else {
        contentFrame?.classList.remove('sidebar--toggle');
        navSelected?.classList.remove('nav__selector--toggle');
      }
    });
  });
</script>
